model Order {
    orderId             Int                  @id @default(autoincrement())
    customerId          Int
    customer            Customer             @relation(fields: [customerId], references: [customerId])
    couponId            Int?
    coupon              Coupon?              @relation(fields: [couponId], references: [couponId])
    statusId            Int
    status              OrderStatus          @relation(fields: [statusId], references: [statusId])
    totalAmount         Float
    recipientName       String?
    deliveryPhone       String?
    deliveryAddress     String?
    note                String?
    createdAt           DateTime             @default(now())
    deliveredAt         DateTime?
    refundedAt          DateTime?
    orderItems          OrderItem[]
    orderUpdateLogs     OrderUpdateLog[]
    inventoryUpdateLogs InventoryUpdateLog[]

    @@map("orders")
}

model OrderItem {
    orderId       Int
    order         Order       @relation(fields: [orderId], references: [orderId])
    productItemId Int
    productItem   ProductItem @relation(fields: [productItemId], references: [productItemId])
    price         Float
    quantity      Int

    @@id([orderId, productItemId])
    @@map("order_items")
}

model OrderUpdateLog {
    logId          Int         @id @default(autoincrement())
    orderId        Int
    order          Order       @relation(fields: [orderId], references: [orderId])
    statusId       Int
    status         OrderStatus @relation(fields: [statusId], references: [statusId])
    explanation    String?
    updatedAt      DateTime    @default(now())
    updatedBy      Int
    updatedByStaff Staff       @relation(fields: [updatedBy], references: [staffId])

    @@map("order_update_logs")
}

model OrderStatus {
    statusId               Int                     @id @default(autoincrement())
    name                   String                  @unique
    description            String                  @db.Text
    color                  String                  @default("#f4f4f5")
    isDefault              Boolean                 @default(false)
    isExplanationRequired  Boolean                 @default(false)
    explanationLabel       String?
    shouldReserveStock     Boolean                 @default(false)
    shouldReleaseStock     Boolean                 @default(false)
    shouldReduceStock      Boolean                 @default(false)
    shouldIncreaseStock    Boolean                 @default(false)
    shouldMarkAsDelivered  Boolean                 @default(false)
    shouldMarkAsRefunded   Boolean                 @default(false)
    shouldSendNotification Boolean                 @default(false)
    orders                 Order[]
    updateLogs             OrderUpdateLog[]
    fromStatusTransitions  OrderStatusTransition[] @relation("fromStatus")
    toStatusTransitions    OrderStatusTransition[] @relation("toStatus")

    @@map("order_statuses")
}

model OrderStatusTransition {
    fromStatusId       Int
    fromStatus         OrderStatus @relation("fromStatus", fields: [fromStatusId], references: [statusId])
    toStatusId         Int
    toStatus           OrderStatus @relation("toStatus", fields: [toStatusId], references: [statusId])
    label              String      @unique
    isScanningRequired Boolean     @default(false)

    @@id([fromStatusId, toStatusId])
    @@map("order_status_transitions")
}
