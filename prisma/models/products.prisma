model RootProduct {
    rootProductId  Int                @id @default(autoincrement())
    brandId        Int
    brand          ProductBrand       @relation(fields: [brandId], references: [brandId])
    name           String             @unique
    slug           String             @unique
    description    String
    price          Float
    isAccessory    Boolean            @default(false)
    createdAt      DateTime           @default(now())
    createdBy      Int
    createdByStaff Staff              @relation(fields: [createdBy], references: [staffId])
    productItems   ProductItem[]
    images         ProductImage[]
    promotions     ProductPromotion[]
    shoeFeature    ShoeFeature?

    @@index([name, slug])
    @@map("root_products")
}

model ProductItem {
    productItemId     Int                @id @default(autoincrement())
    rootProductId     Int
    rootProduct       RootProduct        @relation(fields: [rootProductId], references: [rootProductId])
    size              String             @default("Mặc định")
    stock             Int                @default(0)
    cartItems         CartItem[]
    orderItems        OrderItem[]
    importItems       ImportItem[]
    damageReportItems DamageReportItem[]

    @@unique([rootProductId, size])
    @@map("product_items")
}

model ProductImage {
    imageId       Int         @id @default(autoincrement())
    rootProductId Int
    rootProduct   RootProduct @relation(fields: [rootProductId], references: [rootProductId])
    url           String

    @@unique([rootProductId, url])
    @@map("product_images")
}

model ProductBrand {
    brandId      Int           @id @default(autoincrement())
    name         String
    description  String
    logoUrl      String?
    rootProducts RootProduct[]

    @@index([name])
    @@map("product_brands")
}

model ShoeFeature {
    shoeFeatureId    Int                      @id @default(autoincrement())
    rootProductId    Int                      @unique
    rootProduct      RootProduct              @relation(fields: [rootProductId], references: [rootProductId])
    categoryId       Int
    category         ShoeCategory             @relation(fields: [categoryId], references: [categoryId])
    gender           ShoeGender               @default(UNISEX)
    upperMaterial    String
    soleMaterial     String
    liningMaterial   String
    closureType      String
    toeShape         String
    waterResistant   String
    breathability    String
    pattern          String
    countryOfOrigin  String
    primaryColor     String
    secondaryColor   String?
    heelHeight       Float
    durabilityRating Float
    releaseYear      Int
    occasionTags     ShoeFeatureOccasionTag[]
    designTags       ShoeFeatureDesignTag[]

    @@map("shoe_features")
}

model OccasionTag {
    occasionTagId Int                      @id @default(autoincrement())
    name          String                   @unique
    shoeFeatures  ShoeFeatureOccasionTag[]

    @@map("occasion_tags")
}

model ShoeFeatureOccasionTag {
    shoeFeatureId Int
    shoeFeature   ShoeFeature @relation(fields: [shoeFeatureId], references: [shoeFeatureId])
    occasionTagId Int
    occasionTag   OccasionTag @relation(fields: [occasionTagId], references: [occasionTagId])

    @@id([shoeFeatureId, occasionTagId])
    @@map("shoe_feature_occasion_tag")
}

model DesignTag {
    designTagId  Int                    @id @default(autoincrement())
    name         String                 @unique
    shoeFeatures ShoeFeatureDesignTag[]

    @@map("design_tags")
}

model ShoeFeatureDesignTag {
    shoeFeatureId Int
    shoeFeature   ShoeFeature @relation(fields: [shoeFeatureId], references: [shoeFeatureId])
    designTagId   Int
    designTag     DesignTag   @relation(fields: [designTagId], references: [designTagId])

    @@id([shoeFeatureId, designTagId])
    @@map("shoe_feature_design_tag")
}

model ShoeCategory {
    categoryId     Int           @id @default(autoincrement())
    name           String        @unique
    createdAt      DateTime      @default(now())
    createdBy      Int
    createdByStaff Staff         @relation(fields: [createdBy], references: [staffId])
    shoeFeatures   ShoeFeature[]

    @@index([name])
    @@map("shoe_categories")
}
